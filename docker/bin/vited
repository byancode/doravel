#!/bin/bash
source /root/.bashrc

cleanup() {
    if [ ! -z "$child" ]; then
        kill -SIGTERM $child 2>/dev/null
    fi
    exit 0;
}

trap cleanup SIGQUIT
trap cleanup SIGTERM
trap cleanup EXIT

if [ ! -d node_modules ]; then
    gum log --time rfc822 --level fatal "No has instalado las dependencias de Node.js"
    exit 1
fi

source $(get_env_file $APP_ENV)

VITE_HOST=${VITE_HOST:-"0.0.0.0"}
VITE_PORT=${VITE_PORT:-5173}

/usr/local/bin/npx vite dev --host $VITE_HOST --port $VITE_PORT --strictPort &
child=$!
wait "$child"