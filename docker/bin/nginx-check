#!/bin/sh

URL="http://localhost"

while true; do
    sleep 1

    if curl -s -o /dev/null -w "%{http_code}" $URL | grep -q 502; then
        pgrep nginx | xargs kill -9
        sleep 2
    fi
done