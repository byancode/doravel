#!/bin/ash

set -eu

if [ ! -f /usr/bin/supervisorctl ]; then
    gum log --time rfc822 --level fatal "No has instalado Supervisor"
    # TODO - aqui debe hacer informacion de como usar el comando builder para instalar Supervisor
    exit 1
fi

if [ ! -f /run/supervisord.sock ]; then
    gum log --time rfc822 --level fatal "No has iniciado Supervisor con doraveld"
    # TODO - aqui debe hacer informacion de como usar el comando builder para instalar Supervisor
    exit 1
fi

CONFIGURATION="$APP_PATH/.doravel/supervisord/$APP_ENV.conf"

if [ ! -f $CONFIGURATION ]; then
    gum log --time rfc822 --level fatal "No se encontró el archivo de configuración $CONFIGURATION"
    exit 1
fi

while [[ $# -gt 0 ]]; do
    case "$1" in
        -c|--configuration)
            CONFIGURATION=$2
            shift 2
            ;;
        *)
            break
            ;;
    esac
done

/usr/bin/supervisorctl  --configuration $CONFIGURATION $@